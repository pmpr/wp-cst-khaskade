/*! For license information please see manual-order.qIZva49AB.js.LICENSE.txt */
!function(){const e=PRHelper.getHTML(),t=PRHelper.getType(),r=PRHelper.getHook(),n=PRHelper.getForm(),o=PRHelper.getRequest(),l=PRHelper.getSetting();function a(r,a=!0){const i=e.getParent(r,".pr-modal-container"),s=e.getElements(".pr-manual-order select.product-search",i);let d={},c=[];if(t.each(s,(r=>{const o=e.getParent(r,".pr-field-collection-item-fieldset"),l=e.getElement("input.product-quantity",o),a=n.getFieldValue(r),i=n.getFieldValue(l);i<=0?c.push({key:"invalid_quantity",element:l}):t.isEmpty(a)?c.push({key:"invalid_product",element:r}):d.hasOwnProperty(a)?c.push({key:"duplicate_product",element:r}):d[a]=i})),!t.isEmpty(c))return t.each(c,(e=>{n.showFieldMessage(e.element,l.getOption(`errors.${e.key}`),!0)})),!1;if(a){const t=PRBackendHelper.getModal().getCurrent();t.showSpinner(),o.ajax(l.getOption("ajax.calculate_order_total")).onSuccess((t=>{e.replace(t.total_formated,e.getElement(".total-price",i))})).onError((e=>{t.showMessage(PRHelper.getTool().error2string(e))})).onFinally((()=>{t.hideSpinner()})).addNonce().send({products:d})}return!0}r.bubbling("input",((e,t)=>{a(t)}),".pr-manual-order .product-quantity"),r.addAction("form_generator_collection_item_removed",(t=>{e.is(t,"#products_collection")&&a(t)})),r.bubbling("change",((t,r)=>{e.is(r,"select")&&a(r)}),".pr-manual-order .product-search"),r.bubbling("click",((r,i)=>{const s=PRBackendHelper.getModal().getCurrent();if(s.showSpinner(),a(i,!1)){const r=e.getParent(i,".pr-modal-container"),a=e.getElement("#manual-order-form",r),d=n.getInvalidFields(a);t.isEmpty(d)?o.ajax(l.getOption("ajax.submit_manual_order")).onSuccess((e=>{s.close(),PRBackendHelper.getHTML().toast({text:e,duration:5e3})})).onError((e=>{s.showMessage(PRHelper.getTool().error2string(e))})).onFinally((()=>{s.hideSpinner()})).addNonce().send(e.serializeForm(a)):(t.each(d,(({field:e})=>{n.showFieldMessage(e,l.getOption("errors.required"),!0)})),s.hideSpinner())}else s.hideSpinner(),s.showMessage(l.getOption("errors.invalid_products"))}),".pr-modal-actions > .pr-submit-manual-order")}();